<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Xendit Cards POC</title>
    <script src="https://js.xendit.co/v1/xendit.min.js"></script>
    <script src="{{ url_for('static', filename='js/xendit_cards.js') }}" defer></script>
</head>

<body>
    <h1>Xendit Cards Proof-of-Concept</h1>

    <hr>
    <h2>Log in normally and paste session token here</h2>
    <input id="auth_token" placeholder="Auth token"><br>

    <hr>
    <h2>1. Card Management</h2>
    <h3>1.1. Tokenize card and save to backend</h3>
    <form id="save-form">
        <label for="save-card-number">Card Number:</label><br>
        <input id="save-card-number" placeholder="Card Number" , value="4000000000002503" required><br>

        <label for="save-exp-month">Expiration Month (MM)</label><br>
        <input id="save-exp-month" placeholder="MM" maxlength="2" , value="12" required><br>

        <label for="save-exp-year">Expiration Year (YYYY)</label><br>
        <input id="save-exp-year" placeholder="YYYY" maxlength="4" , value="2040" required><br>

        <label for="save-card-cvn">Card CVV:</label><br>
        <input id="save-card-cvn" placeholder="CVV" maxlength="4" , value="123" required><br>

        <label for="save-firstname">First Name:</label><br>
        <input id="save-firstname" placeholder="First Name" , value="firstname" required><br>

        <label for="save-lastname">Last Name:</label><br>
        <input id="save-lastname" placeholder="Last Name" , value="lastname" required><br>

        <label for="save-email">Email:</label><br>
        <input id="save-email" placeholder="Email" type="email" , value="first_last@gmail.com" required><br>

        <label for="save-phone">Phone:</label><br>
        <input id="save-phone" placeholder="Phone" , value="+68213445345345" required><br>
        <button type="submit">Tokenize & Save</button>
    </form>
    <pre id="save-response-xendit" style="white-space: pre-wrap;"></pre>
    <pre id="save-response-backend" style="white-space: pre-wrap;"></pre>
    <br>

    <h3>1.2. Get Saved Cards</h3>
    <p>Retrieve all saved cards</p>
    <button id="load-btn">Load My Cards</button><br>
    <pre id="cards-response-backend" style="white-space: pre-wrap;"></pre>
    <br>

    <h3>1.3. Choose a Card</h3>
    <select id="card-select"></select>
    <br>
    <br>

    <h3>1.4. Get Full Card Details</h3>
    <p>This endpoint is important as it returns the card's token, which is one of the things you need to make a
        purchase.</p>
    <p>Getting details of</p>
    <pre class="card-id-input"></pre>
    <button id="details-btn">Get Card Details</button><br>
    <pre id="details-response-backend" style="white-space: pre-wrap;"></pre>
    <br>

    <h3>1.5. Delete a Card</h3>
    <p>Deleting card</p>
    <pre class="card-id-input"></pre>
    <button id="delete-btn">Delete My Card</button><br>
    <pre id="delete-response-backend" style="white-space: pre-wrap;"></pre>
    <br>

    <h3>1.6. Update a Card</h3>
    <p>When a saved token becomes invalid, for instance when it expires or its CVV changes, you can send a PUT request
        to the backend to update it.</p>
    <form id="update-form">
        <label for="update-card-number">Card Number:</label><br>
        <input id="update-card-number" placeholder="Card Number" , value="4000000000002503" required><br>

        <label for="update-exp-month">Expiration Month (MM)</label><br>
        <input id="update-exp-month" placeholder="MM" maxlength="2" , value="12" required><br>

        <label for="update-exp-year">Expiration Year (YYYY)</label><br>
        <input id="update-exp-year" placeholder="YYYY" maxlength="4" , value="2040" required><br>

        <label for="update-card-cvn">Card CVV:</label><br>
        <input id="update-card-cvn" placeholder="CVV" maxlength="4" , value="123" required><br>

        <label for="update-firstname">First Name:</label><br>
        <input id="update-firstname" placeholder="First Name" , value="firstname" required><br>

        <label for="update-lastname">Last Name:</label><br>
        <input id="update-lastname" placeholder="Last Name" , value="lastname" required><br>

        <label for="update-email">Email:</label><br>
        <input id="update-email" placeholder="Email" type="email" , value="first_last@gmail.com" required><br>

        <label for="update-phone">Phone:</label><br>
        <input id="update-phone" placeholder="Phone" , value="+68213445345345" required><br>

        <p>Updating card</p>
        <pre class="card-id-input"></pre>
        <button type="submit">Tokenize & Update</button>
    </form>
    <pre id="update-response-xendit" style="white-space: pre-wrap;"></pre>
    <pre id="update-response-backend" style="white-space: pre-wrap;"></pre>
    <br>

    <hr>
    <h2>2. Authentication</h2>
    <p>Before a card's token can be used to make purchases, it must first be authenticated. Authentication happens
        entirely in the frontend. The frontend will call <code>Xendit.card.createAuthentication()</code>. Then, the
        response from Xendit will contain a URL containing further instructions from the user's bank on how to
        authenticate their card (usually OTP). So, the frontend should open a new window and redirect the user there to
        complete their authentication.</p>

    <p>To prove that you can't make purchases before authenticating, try clicking the button below. Choose one of the
        packets below to use for the demo</p>
    <select id="packet-select"></select>
    <br>
    <br>

    <h3>2.1. Charge without Auth (should fail)</h3>
    <p>Buying packet</p>
    <pre class="packet-id-input"></pre>
    <p>With card</p>
    <pre class="card-id-input"></pre>
    <button id="charge-noauth-btn">Charge</button>
    <pre id="charge-noauth-response" style="white-space: pre-wrap;"></pre>
    <br>

    <h3>2.2. Authenticate (3-DS)</h3>
    <h3>Authenticate one of your saved cards before making a purchase</h3>
    <p>Authenticating</p>
    <pre class="card-id-input"></pre>
    <p>To buy</p>
    <pre class="packet-id-input"></pre>
    <button id="auth-btn">Run 3-DS</button>
    <input id="auth-id" placeholder="Auth ID" readonly size="40"><br>
    <pre id="auth-response" style="white-space: pre-wrap;"></pre>
    <br>

    <hr>
    <h2>3. Charging</h2>
    <p>Once you have your card token and authentication id, you're ready to make a purchase</p>
    <p>Using card</p>
    <pre class="card-id-input"></pre>
    <p>And authentication_id</p>
    <pre id="auth-id-input"></pre>
    <p>To buy</p>
    <pre class="packet-id-input"></pre>
    <button id="charge-auth-btn">Charge</button>
    <pre id="charge-auth-response" style="white-space: pre-wrap;"></pre>

    <hr>
    <h2>4. Get Charge Status (Optional)</h2>
    <p>One of the statuses you can get after making a charge to Xendit is "AUTHORIZED". This means that the card has
        been approved for purchase but the actual money hasn't moved yet. If this happens, you can poll
        <code>/financials/card-charge/&lt;charge_id&gt; for updates on its status.</code></p>
    <button id="get-charge-btn">Get Charge Status</button>
    <input id="get-charge-id" placeholder="Charge ID" size="40"><br>
    <pre id="get-charge-response" style="white-space: pre-wrap;"></pre>

    <hr>
    <h2>5. Verify Transaction</h2>
    <p>Verify that the transaction is successful and you've got your packet</p>
    <button id="verify-btn">Verify</button>
    <input id="verify-id" placeholder="Transaction ID" size="40"><br>
    <pre id="verify-response" style="white-space: pre-wrap;"></pre>

    <div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);">
        <div style="position:absolute;top:5%;left:5%;width:90%;height:90%;background:#fff;border:1px solid #ccc;">
            <button onclick="document.getElementById('modal').style.display='none'">Close</button>
            <iframe id="modal-frame" style="width:100%;height:90%;border:none;"></iframe>
        </div>
    </div>
</body>

</html>